<!-- Collect all tags from posts and notes -->
{% assign all_tags = "" | split: "" %}
{% assign all_items = site.posts | concat: site.notes %}
{% for item in all_items %}
  {% if item.tags %}
    {% assign tags_string = item.tags | join: "," %}
    {% assign item_tags = tags_string | split: "," %}
    {% for tag in item_tags %}
      {% assign clean_tag = tag | strip | remove: '"' | remove: '[' | remove: ']' %}
      {% if clean_tag != "" %}
        {% unless all_tags contains clean_tag %}
          {% assign all_tags = all_tags | push: clean_tag %}
        {% endunless %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}
{% assign all_tags = all_tags | sort %}

<!-- Tag cloud -->
<div class="tag-cloud">
  {% for tag in all_tags %}
    <a href="#{{ tag | slugify }}" class="tag-pill">{{ tag }}</a>
  {% endfor %}
</div>

<!-- Posts and notes by tag -->
<div class="tags-list">
  {% for tag in all_tags %}
    <div class="tag-section" id="{{ tag | slugify }}">
      <h3>{{ tag }}</h3>
      <ul>
        {% for item in all_items %}
          {% assign item_tags_string = item.tags | join: "," %}
          {% if item_tags_string contains tag %}
            <li>
              <a href="{{ site.baseurl }}{{ item.url }}">{{ item.title }}</a>
              {% if item.date %}<span class="post-date">{{ item.date | date: "%b %Y" }}</span>{% endif %}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
</div>
